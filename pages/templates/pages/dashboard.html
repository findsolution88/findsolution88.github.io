{% extends 'pages/base.html' %}

{% block head %}

.chart-container{
max-width: 236px;
}
.wrap{
height: 100vh;
display: flex;
justify-content: center;
align-items: center;
}
html, body {
height:100%;
width:100%;
margin:0;
<!--            padding:0;-->
padding: 2em;
}

#myChart {
height:100%;
width:100%;
min-height:150px;

}

.zc-ref {
display:none;
}
.section-title {
text-align: center;
overflow: hidden;
margin-bottom: 1.3em;
}

.tag {
text-transform: uppercase;
position: relative;
line-height: 2.5em;
padding: 0 1em;
display: inline-block;
}


.tag-colored {
background-color: #9a9ba1;
color: #fff;
}

.tag:before,
.tag:after {
content: "";
height: 1px;
/* any width higher than the widest part of the page */
width: 1000px;
position: absolute;
top: 50%;
display: block;
}

<!--.tag-colored:before,-->
<!--.tag-colored:after {-->
<!--  background-color: skyblue;-->
<!--}-->

<!--.title {-->
<!--  padding-right:100px 20px 100px 0;-->
<!--  -->
<!--  margin-right:10px;-->
<!--  position:relative;-->
<!--  left: -1100px;-->
<!--}-->
h2 {
font-size:4em;
color:black;
text-transform:uppercase;
text-align:right;
direction:rtl;
line-height:0.8;
padding:30px 10px 160px 0;
font-weight:700;
font-size:100%;
line-height:1.5;
}


<style type="text/css">
hr { border-top:1px solid #9C9C9C; border-bottom:1px solid #F6F6F6; }







</style>
{% endblock %}


{% block body %}

<br/>
<br/>
<br/>
<br/>
<br/>

<div class="container">
    <div class="row">
        <div class="section-title offset-5 px-5">
            <span class="tag tag-colored">{{query1}}{% if query2 %} & {{query2}} {% endif %}</span>
        </div>
    </div>
    <!--    1st row : lineChart-->
    <div class="row d-flex justify-content-center" style="display: table;">

        <div class="col-1" style="border-right:5px solid black;">
            <h2>Time<br>Series<br>Chart</h2>
        </div>
        <div class="col-11">
            <div id="myChart1"></div>
        </div>
    </div>

    <br/>
    <br/>
    <br/>
    <br/>
    <br/>

    <!--    2nd row : PieChart-->
    <div class="section-title row">
        {% if query2 %}
        <div class="col-5 offset-1">
            <span class="tag tag-colored">{{query1}}</span>
        </div>
        <div class="col-5 offset">
            <span class="tag tag-colored">{{query2}}</span>
        </div>
        {% else %}
        <div class="offset-5 px-5">
            <span class="tag tag-colored">{{query1}}</span>
        </div>
        {% endif %}
    </div>

    <div class="row">
        <div class="col-1" style="border-right:5px solid black;">
            <h2>article<br>ratio<br>by<br>Category</h2>
        </div>
        {% if query2 %}

        <!--  1st PieChart-->
        <div class="col-5 mt-10 mb-8">
            <div title="piechart">
                <div>
                    <canvas id="myChart2"></canvas>
                </div>
            </div>
        </div>
        <!--  2nd PieChart-->
        <div class="col-5 mt-10 mb-8">
            <div title="3rdchart">
                <div>
                    <canvas id="myChart3"></canvas>
                </div>
            </div>
        </div>
        {% else %}
        <!--  1st PieChart-->
        <div class="col-8 offset-1">
            <div title="piechart">
                <div>
                    <canvas id="myChart2"></canvas>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>

    <!--    3row : Bar Chart-->
    <div class="section-title row">
        {% if query2 %}
        <div class="col-5 offset-1">
            <span class="tag tag-colored">{{query1}}</span>
        </div>
        <div class="col-5 offset">
            <span class="tag tag-colored">{{query2}}</span>
        </div>
        {% else %}
        <div class="offset-5 px-5">
            <span class="tag tag-colored">{{query1}}</span>
        </div>
        {% endif %}
    </div>

    <!--  1st BarChart-->
    <div class="row">
        <div class="col-1" style="border-right:5px solid black;">
            <h2>news<br>frequency<br>by<br>media</h2>
        </div>

        {% if query2 %}

        <div class="col-5 mt-10 mb-8">
            <div title="4thchart">
                <div>
                    <canvas id="myChart4"></canvas>
                </div>
            </div>
        </div>
        <!--  2nd BarChart-->
        <div class="col-5 mt-10 mb-8">
            <div title="5thchart">
                <div>
                    <canvas id="myChart5"></canvas>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <!--  1st BarChart-->
    <div class="col-8 offset-1">
        <div title="4thchart">
            <div>
                <canvas id="myChart4"></canvas>
            </div>
        </div>
    </div>
</div>
{% endif %}


<br/>
<br/>
<br/>
<br/>
<br/>
<div class="section-title row">
    {% if query2 %}
    <div class="col-5 offset-1">
        <span class="tag tag-colored">{{query1}}</span>
    </div>
    <div class="col-5 offset">
        <span class="tag tag-colored">{{query2}}</span>
    </div>
    {% else %}
    <div class="offset-5 px-5">
        <span class="tag tag-colored">{{query1}}</span>
    </div>
    {% endif %}
</div>

<div class="row">
    <div class="col-1" style="border-right:5px solid black;">
        <h2>Word<br>cloud</h2>
    </div>
    {% if query2 %}
    <!--1st WordCloud-->
    <div class="col-5 mt-10 mb-8">
        <div id="myChart6"></div>
    </div>
    <!--2nd WordCloud-->
    <div class="col-5 mt-10 mb-8">
        <div id="myChart7"></div>
    </div>

    {% else %}
    <!--1st WordCloud-->
    <div class="col-8 offset-1">
        <div id="myChart6"></div>
    </div>
    {% endif %}
</div>
<!--</div>-->


<!--4 row : WordCloud -->


    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <hr/>
<!--5 row : query 1 articles-->
<!--5 row : query 1 articles-->
<div class="row mt-5 ">
    <div class="col-1" style="border-right:5px solid black;">
        <h2>representative<br>article<br></h2>
    </div>
    <div class="col-8 offset-1">
    <span class="tag tag-colored">{{query1}} 대표 기사 </span>
    <table class="type09">
        <thead >
        <tr>
            <th scope="cols" style="width: 90px;">날짜</th>
            <th scope="cols" style="width: 300px;">기사제목</th>
        </tr>
        </thead>

        <tbody>
        {% for i in news1 %}
        <tr>
            <th>{{ i.date.year }}-{{ i.date.month }}-{{ i.date.day }}</th>
            <th><a href="{% url 'pages:topic' i.id %}" target="_blank">{{ i.title }}</a></th>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
</div>

<br/>
<!--6 row : query 2 articles -->
{% if query2 %}
<div class="row mt-5 ">
    <div class="col-1" style="border-right:5px solid black;">
        <h2>representative<br>article<br></h2>
    </div>
    <div class="col-8 offset-1">
    <span class="tag tag-colored">{{query2}} 대표 기사 </span>
    <table class="type09">
        <thead>
        <tr>
            <th scope="cols" style="width: 90px;">날짜</th>
            <th scope="cols" style="width: 300px;">기사제목</th>
        </tr>
        </thead>
        <tbody>
        {% for j in news2 %}
        <tr>
            <th>{{ j.date.year }}-{{ j.date.month }}-{{ j.date.day }}</th>
            <th><a href="{% url 'pages:topic' j.id %}" target="_blank">{{ j.title }}</a></th>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
</div>
{% endif %}
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/ee70558903.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.3/Chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.js"></script>
<script src="https://cdn.zingchart.com/zingchart.min.js"></script>
<script src="https://cdn.zingchart.com/zingchart-core.min.js"></script>
<script>zingchart.MODULESDIR="https://cdn.zingchart.com/modules/";</script>
<script>
    {% if query2 %}
        var ctx1 = document.getElementById("myChart1");
        const x = [
            {% for i in ts %}
                '{{ i.date }}',
            {% endfor %}
        ];
        const y = [
            {% for i in ts %}
                '{{ i.total }}',
            {% endfor %}
        ];const x2 = [
            {% for i in ts2 %}
                '{{ i.date }}',
            {% endfor %}
        ];
        const y2 = [
            {% for i in ts2 %}
                '{{ i.total }}',
            {% endfor %}
        ];

        var trace1 = {
        type: "scatter",
        mode: "lines",
        name: '{{query1}}',
        x: x,
        y: y,
        line: {color: '#F5BA45'}
        }

        var trace2 = {
        type: "scatter",
        mode: "lines",
        name: '{{query2}}',
        x: x2,
        y: y2,
        line: {color: '#B3A5EF'}
        }

        var tsdata = [trace1,trace2];

        var layout = {
            title: "",
            xaxis: {
                autorange: true,
                range: ['2009-01-01', '2019-06-16'],
                rangeselector: {
                    buttons: [
                        {
                            count: 1,
                            label: '1m',
                            step: 'month',
                            stepmode: 'backward'
                        },
                        {
                            count: 6,
                            label: '6m',
                            step: 'month',
                            stepmode: 'backward'
                        },
                        {
                            step: 'all'
                        }
                    ]
                },
                rangeslider: {
                    range: ['2015-02-17', '2019-02-16']
                },
                type: 'date'
                },
                yaxis: {
                autorange: true,
                range: [86.8700008333, 138.870004167],
                type: 'linear'
            }
        };

        Plotly.plot(ctx1, tsdata, layout);



        var ctx2 = document.getElementById("myChart2").getContext("2d");
        var ctx3 = document.getElementById("myChart3").getContext("2d");
        const colors = ['rgba(21, 176, 231, .5)',
                        'rgba(50, 162, 74, .5)',
                        'rgba(19, 47, 80,.5)',
                        'rgba(254, 101, 42, .5)',
                        'rgba(51, 51, 51,.5)']

        const data1 = [
            {% for j in pie %}
        {{ j.total }},
        {% endfor %}];

        const dates1 = [
            {% for j in pie %}
        "{{ j.cat_selected }}",
        {% endfor %}];

        const data2 = [
            {% for i in pie2 %}
                {{ i.total }},
            {% endfor %}];

        const dates2 = [
            {% for i in pie2 %}
             "{{ i.cat_selected }}",
            {% endfor %}];

        var myChart2 = new Chart(ctx2,{
            type: 'doughnut',
            data: {
                labels: dates1,

                datasets: [{
                    label: dates1,
                    backgroundColor: colors,
                    pointBackgroundColor: colors,
                    borderColor: colors,
                    data: data1,
                    borderColor: 'white',
                    borderWidth: 1,

                }]
            },
            options: {
                animation: {
                    animateScale: true
                },
                legend: {
                    position: 'top',
                    labels: {
                        boxWidth: 12,
                        fontSize: 12
                    }
                }
            }
        });
        var myChart3 = new Chart(ctx3,{
            type: 'doughnut',
            data: {
                labels: dates2,

                datasets: [{
                    label: dates2,
                    backgroundColor: colors,
                    pointBackgroundColor: colors,
                    borderColor: colors,
                    data: data2,
                    borderColor: 'white',
                    borderWidth: 1,

                }]
            },
            options: {
                animation: {
                    animateScale: true
                },
                legend: {
                    position: 'top',
                    labels: {
                        boxWidth: 12,
                        fontSize: 12
                    }
                }
            }
        });

        var ctx4 = document.getElementById('myChart4');
        var myChart4 = new Chart(ctx4, {
            type: 'horizontalBar',
            data: {
                labels: [
                    {% for j in horizontalBar %}
                        '{{ j.company }}',
                    {% endfor %}
                ],
                datasets: [{
                    label: '{{ query1 }} 기사 빈도  그래프',
                    data:
                    [
                        {% for j in horizontalBar %}
                            {{ j.total }},
                        {% endfor %}
                    ],
                    borderColor:[
                    'rgba(54,162,235,0.2)',
                    'rgba(130,162,235,0.2)',
                    'rgba(20,162,3,0.2)',
                    'rgba(1,50,235,0.2)',
                    'rgba(270,162,235,0.2)',
                    'rgba(54,300,14,0.2)',
                    'rgba(54,15,235,0.2)',

                    ],
                    borderWidth: 10,
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: false,
                        }
                    }]
                }
            }
        });
        var ctx5 = document.getElementById('myChart5');
        var myChart5 = new Chart(ctx5, {
            type: 'horizontalBar',
            data: {
                labels: [
                    {% for j in horizontalBar2 %}
                        '{{ j.company }}',
                    {% endfor %}
                ],
                datasets: [{
                    label: '{{ query2 }} 기사 빈도  그래프',
                    data:
                    [
                        {% for j in horizontalBar2 %}
                            {{ j.total }},
                        {% endfor %}
                    ],
                    borderColor:[
                    'rgba(54,162,235,0.2)',
                    'rgba(130,162,235,0.2)',
                    'rgba(20,162,3,0.2)',
                    'rgba(1,50,235,0.2)',
                    'rgba(270,162,235,0.2)',
                    'rgba(54,300,14,0.2)',
                    'rgba(54,15,235,0.2)',

                    ],
                    borderWidth: 10,
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: false,
                        }
                    }]
                }
            }
        });

        ZC.LICENSE = ["b55b025e438fa8a98e32482b5f768ff5"];
        var myConfig = {
            type: 'wordcloud',
            options: {
                text:'{{ word_cloud }}',
                ignore: ['&#39','금지&#39'],



                style:{
                    fontFamily: 'Nanum Barun Gothic',
                    fontWeight: 500,
                }
            }
        };

        zingchart.render({
            id: 'myChart6',
            data: myConfig,
            height: 300,
            width: '100%',

        });


        var myConfig2 = {
            type: 'wordcloud',
            options: {
                text:'{{ word_cloud2 }}',
                ignore: ['&#39','금지&#39'],
                style:{
                    fontFamily: 'Nanum Barun Gothic'
                }
            }
        };

        zingchart.render({
            id: 'myChart7',
            data: myConfig2,
            height: 300,
            width: '100%'
        });
    {% else %}
        var ctx = document.getElementById("myChart2").getContext("2d");
        const colors = ['rgba(21, 176, 231, .5)',
            'rgba(50, 162, 74, .5)',
            'rgba(19, 47, 80,.5)',
            'rgba(254, 101, 42, .5)',
            'rgba(51, 51, 51,.5)']

        const data = [
            {% for j in pie %}
        {{ j.total }},
        {% endfor %}];

        const dates = [
            {% for j in pie %}
        "{{ j.cat_selected }}",
        {% endfor %}];

        var myChart2 = new Chart(ctx,{
            type: 'doughnut',
            data: {
                labels: dates,

                datasets: [{
                    label: dates,
                    backgroundColor: colors,
                    pointBackgroundColor: colors,
                    borderColor: colors,
                    data: data,
                    borderColor: 'white',
                    borderWidth: 1,

                }]
            },
            options: {
                animation: {
                    animateScale: true
                },
                legend: {
                    position: 'top',
                    labels: {
                        boxWidth: 12,
                        fontSize: 12
                    }
                }
            }
        });
        var ctx = document.getElementById('myChart4');
        var myChart4 = new Chart(ctx, {
            type: 'horizontalBar',
            data: {
                labels: [
                    {% for j in horizontalBar %}
                        '{{ j.company }}',
                    {% endfor %}
                ],
                datasets: [{
                    label: "'{{ query }}' 기사 빈도  그래프",
                    data:
                    [
                        {% for j in horizontalBar %}
                            {{ j.total }},
                        {% endfor %}
                    ],
                    borderColor:[
                    'rgba(54,162,235,0.2)',
                    'rgba(130,162,235,0.2)',
                    'rgba(20,162,3,0.2)',
                    'rgba(1,50,235,0.2)',
                    'rgba(270,162,235,0.2)',
                    'rgba(54,300,14,0.2)',
                    'rgba(54,15,235,0.2)',

                    ],
                    borderWidth: 10,
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: false,
                        }
                    }]
                }
            }
        });

        ZC.LICENSE = ["b55b025e438fa8a98e32482b5f768ff5"];
        var myConfig = {
            type: 'wordcloud',
            options: {
                text:'{{ word_cloud }}',
                ignore: ['&#39','금지&#39'],
                maxFontSize:200,
                minFontSize:20,
                style:{
                fontFamily:'Nanum Barun Gothico',
                }
            }
        };

        zingchart.render({
            id: 'myChart6',
            data: myConfig,
            height: 600,
            width: 800,
        });
         var ctx1 = document.getElementById("myChart1");
        const x = [
            {% for i in ts %}
                '{{ i.date }}',
            {% endfor %}
        ];
        const y = [
            {% for i in ts %}
                '{{ i.total }}',
            {% endfor %}
        ];
        var trace1 = {
        type: "scatter",
        mode: "lines",
        name: '{{query}}',
        x: x,
        y: y,
        line: {color: '#17BECF'}
        }

        var tsdata = [trace1];

        var layout = {
        title: '',
        xaxis: {
        autorange: true,
        range: ['2009-01-01', '2019-06-16'],
        rangeselector: {buttons: [
        {
        count: 1,
        label: '1m',
        step: 'month',
        stepmode: 'backward'
        },
        {
        count: 6,
        label: '6m',
        step: 'month',
        stepmode: 'backward'
        },
        {step: 'all'}
        ]},
        rangeslider: {range: ['2015-02-17', '2019-02-16']},
        type: 'date'
        },
        yaxis: {
        autorange: true,
        range: [86.8700008333, 138.870004167],
        type: 'linear'
        }
        };

        Plotly.plot(ctx1, tsdata, layout);
    {% endif %}








</script>
</div>
{% endblock %}